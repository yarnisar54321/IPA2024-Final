---
- name: Get Server Model
  ansible.builtin.uri:
    url: "https://{{ hostname }}:{{ https_port }}/redfish/v1\
      /Managers/iDRAC.Embedded.1"
    method: GET
    user: "{{ username | default(lookup('env', 'IDRAC_USERNAME')) }}"
    password: "{{ password | default(lookup('env', 'IDRAC_PASSWORD')) }}"
    validate_certs: "{{ validate_certs }}"
    return_content: true
    status_code: 200
    force_basic_auth: true
  register: idrac_model_response
  no_log: true

- name: Set fact for model
  ansible.builtin.set_fact:
    model1: "{{ idrac_model_response.json.Model }}"

- name: Set the server generation fact
  ansible.builtin.set_fact:
    model: "{{ model1 | regex_search('([0-9]+)G', '\\1') | first | int }}"
