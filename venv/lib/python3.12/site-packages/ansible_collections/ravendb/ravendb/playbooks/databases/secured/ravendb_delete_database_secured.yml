---
- name: Create Database
  hosts: localhost
  gather_facts: no

  roles:
    - ravendb.ravendb.ravendb_python_client_prerequisites

  tasks:
    - name: Ensure RavenDB database is absent (check mode)
      become: true
      ravendb.ravendb.database:
        url: "https://a.ravendbansible.development.run:443"
        certificate_path: /home/user/security/setup_package/admin.client.combined.pem
        database_name: "my_database"
        state: absent
      check_mode: yes

    - name: Ensure RavenDB database is absent
      become: true
      ravendb.ravendb.database:
        url: "https://a.ravendbansible.development.run:443"
        certificate_path: /home/user/security/setup_package/admin.client.combined.pem
        database_name: "my_database"
        state: absent

    - name: Ensure RavenDB database is absent (idempotency check)
      become: true
      ravendb.ravendb.database:
        url: "https://a.ravendbansible.development.run:443"
        certificate_path: /home/user/security/setup_package/admin.client.combined.pem
        database_name: "my_database"
        state: absent